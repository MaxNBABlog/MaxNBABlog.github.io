<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NBA Deep Dives with Max Krupp</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    :root {
      --accent-gold: #c9b037;
      --accent-gold-dark: #a68a1d;
      --accent-gold-light: #f7e7a0;
      --main-bg: #f9f9f9;
      --main-font: #232323;
      --card-bg: #fff;
      --card-shadow: 0 8px 32px rgba(0,0,0,0.10);
    }
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background-color: var(--main-bg);
      color: var(--main-font);
      min-height: 100vh;
    }
    header {
      background-image: url('CeticsImage.jpg');
      background-size: cover;
      background-position: center;
      color: white;
      text-align: center;
      padding: 140px 10px;
      font-size: 2.5em;
      font-weight: bold;
      position: relative;
    }
    header::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
    header span {
      position: relative;
      z-index: 2;
    }
    header .home-button {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 3;
    }
    header .home-button a {
      text-decoration: none;
      color: white;
      font-size: 2em;
      font-weight: bold;
      border: 2px solid white;
      padding: 5px 10px;
      border-radius: 4px;
      display: inline-block;
      transition: color 0.3s, border-color 0.3s;
    }
    header .home-button a:hover {
      color: var(--accent-gold);
      border-color: var(--accent-gold);
    }
    .container {
      display: flex;
      flex: 1;
      gap: 20px;
      padding: 20px;
    }
    .content {
      flex: 1;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--card-shadow);
      min-height: 300px;
    }
    .sidebar {
      width: 300px;
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .post-title {
      cursor: pointer;
      margin-bottom: 14px;
      color: var(--accent-gold);
      font-weight: bold;
      font-size: 1.1em;
      letter-spacing: 0.5px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: color 0.3s, background 0.3s;
      position: relative;
    }
    .post-title .editPostBtn,
    .post-title .deletePostBtn {
      position: absolute;
      right: 0;
      top: 2px;
      font-size: 0.9em;
      padding: 2px 8px;
      margin-left: 5px;
      background: #eee;
      color: #333;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .post-title .editPostBtn:hover,
    .post-title .deletePostBtn:hover {
      background: var(--accent-gold);
      color: #fff;
    }
    .post-title .deletePostBtn {
      right: 55px;
    }
    .story-pro {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      padding: 48px 32px 32px 32px;
      margin-bottom: 32px;
      position: relative;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .story-pro h2 {
      text-align: center;
      font-size: 2.5em;
      color: var(--accent-gold);
      font-weight: 700;
      margin-bottom: 24px;
      letter-spacing: 1px;
    }
    .story-pro .story-image {
      display: block;
      margin: 0 auto 24px auto;
      max-width: 90%;
      max-height: 340px;
      border-radius: 14px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.10);
      object-fit: contain;
      background: #f7f7f7;
    }
    .circle-shadow {
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 0 4px var(--accent-gold), 0 4px 24px rgba(0,0,0,0.18);
    }
    .story-pro .meta {
      margin-bottom: 24px;
      margin-left: 0;
      text-align: left;
    }
    .story-pro .meta .date {
      font-size: 1em;
      color: #888;
      font-weight: 500;
      margin-bottom: 4px;
      display: block;
    }
    .story-pro .meta .author {
      font-size: 1em;
      color: #444;
      font-style: italic;
      font-weight: 500;
      margin-bottom: 0;
      display: block;
    }
    .story-pro .content {
      font-size: 1.18em;
      color: #232323;
      margin-bottom: 32px;
      line-height: 1.7;
      text-align: left;
      padding: 10px 0;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .divider {
      border: none;
      border-top: 2px solid #eee;
      margin: 24px 0 16px 0;
    }
    .comment-section {
      margin-top: 30px;
      padding: 20px;
      background: #fdf7e3;
      border: 1px solid #f7e7a0;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .comment-section h3 {
      margin-bottom: 20px;
      font-size: 1.3em;
      color: var(--accent-gold);
      font-weight: 600;
    }
    .comment {
      margin-bottom: 18px;
      padding: 12px 16px;
      background: #fff;
      border: 1px solid #e3e3e3;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      position: relative;
    }
    .comment p {
      margin: 0 0 6px 0;
      font-size: 1em;
      color: #333;
      display: inline;
    }
    .replyButton {
      margin-top: 5px;
      padding: 4px 12px;
      background: var(--accent-gold);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95em;
      transition: background 0.3s;
    }
    .replyButton:hover {
      background: var(--accent-gold-dark);
    }
    .replies {
      margin-top: 10px;
      padding-left: 18px;
      border-left: 2px solid var(--accent-gold-light);
    }
    .replies p {
      font-style: italic;
      color: #555;
      margin: 5px 0;
      background: #fffbe6;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.97em;
    }
    select,
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 1em;
    }
    textarea {
      resize: none;
    }
    p {
      line-height: 1.6;
    }
    #adminSection {
      display: none;
      padding: 20px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      margin: 20px;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      background: var(--accent-gold);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
      font-size: 1em;
    }
    button:hover {
      background: var(--accent-gold-dark);
    }
    #toggleAdminButton {
      background: #333;
      margin: 20px;
    }
    @media (max-width: 900px) {
      .container { flex-direction: column; }
      .sidebar { width: 100%; margin-top: 20px; }
      .story-pro { padding: 24px 8px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="home-button">
      <a href="#" id="homeButton" title="Go to About Me">&#8962;</a>
    </div>
    <span>NBA Deep Dives with Max Krupp</span>
  </header>
  <div class="container">
    <div class="content" id="postContent" style="text-align: center;">
      <h2>About Me</h2>
      <p>
        Hi, I'm Max Krupp, a Vermont native who's passionate about basketball. I plan to use this blog as an opportunity to share my knowledge of the sport and break down current events at both the professional and collegiate levels. I will discuss trade rumors, free agent signings, transfer portal announcements, player performance, and many other topics that I hope viewers find just as exciting to read as I do to write. Join me as we explore the stories, players, and teams 
        that make the game so exciting.
      </p>
    </div>
    <div class="sidebar">
      <select id="filterSortBar">
        <option value="all">All</option>
        <option value="newest">Newest to Oldest</option>
        <option value="oldest">Oldest to Newest</option>
      </select>
      <div id="postList"></div>
    </div>
  </div>

  <!-- Admin Section with Multiple Paragraph Boxes and Image Controls -->
  <div id="adminSection">
    <h3>Create a New Post</h3>
    <label for="postTitle">Title:</label>
    <input type="text" id="postTitle" placeholder="Enter post title" />
    <label for="postImage">Main Image (optional):</label>
    <input type="file" id="postImage" accept="image/*" />
    <label for="imagePosition">Image Position:</label>
    <select id="imagePosition">
      <option value="top">Top (default)</option>
      <option value="left">Left of text</option>
      <option value="right">Right of text</option>
      <option value="none">Do not display</option>
    </select>
    <label for="imageSize">Image Size:</label>
    <select id="imageSize">
      <option value="small">Small</option>
      <option value="medium" selected>Medium</option>
      <option value="large">Large</option>
    </select>
    <label for="imageShape">Image Shape:</label>
    <select id="imageShape">
      <option value="natural">Natural</option>
      <option value="circle">Circle</option>
      <option value="circle-shadow">Circle with Shadow</option>
      <option value="rounded">Rounded Corners</option>
    </select>
    <div id="paragraphBoxes"></div>
    <button id="addParagraphBoxButton" style="margin-bottom:15px;">Add Text Box</button>
    <label for="postDate">Date:</label>
    <input type="date" id="postDate" />
    <button id="addPostButton">Add Post</button>
  </div>

  <button id="toggleAdminButton">Toggle Admin Interface</button>

  <script>
    // Use localStorage to persist posts
    const STORAGE_KEY = 'nba_blog_posts';

    function savePosts() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
    }

    function loadPosts() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          return JSON.parse(saved);
        } catch {
          return [];
        }
      }
      return [];
    }

    let posts = loadPosts();

    // --- Insert "New Look Celtics" post if not present ---
    const newLookCelticsContent = `
<p>
  The Boston Celtics have undergone a dramatic transformation this season, bringing in new faces and reshaping their core. Let’s break down the impact and fit of each major addition to the roster:
</p>

<h3 style="color:#007a33;margin-top:2em;">Jrue Holiday</h3>
<p>
  Jrue Holiday brings championship experience and elite defense to the Celtics’ backcourt. His ability to guard multiple positions and facilitate the offense makes him a perfect fit alongside Jayson Tatum and Jaylen Brown. Holiday’s leadership and poise in clutch moments will be invaluable in the playoffs.
</p>

<h3 style="color:#007a33;margin-top:2em;">Kristaps Porziņģis</h3>
<p>
  The addition of Porziņģis gives Boston a true stretch big who can protect the rim and space the floor. His shooting opens up driving lanes for the wings, and his length adds a new dimension to the Celtics’ defense. If he stays healthy, Porziņģis could be the X-factor for a deep playoff run.
</p>

<h3 style="color:#007a33;margin-top:2em;">Jayson Tatum</h3>
<p>
  Tatum continues to evolve as the franchise cornerstone. Surrounded by new talent, he’s poised to take another leap as a scorer and playmaker. Expect Tatum to benefit from less defensive attention and more open looks, making him an early MVP candidate.
</p>

<h3 style="color:#007a33;margin-top:2em;">Jaylen Brown</h3>
<p>
  Brown’s athleticism and two-way play remain crucial for Boston’s success. With Holiday and Porziņģis on board, Brown can focus on attacking the rim and locking down opposing wings. His chemistry with Tatum will be key to the Celtics’ title hopes.
</p>

<hr class="divider" />
<p style="font-style:italic;color:#888;text-align:center;">
  The Celtics’ new core is built for both offense and defense. If these stars stay healthy and mesh, Boston could be raising Banner 18 soon.
</p>
`;

    if (!posts.some(p => p.title && p.title.toLowerCase() === "new look celtics")) {
      posts.unshift({
        title: "New Look Celtics",
        content: newLookCelticsContent,
        date: "2025-07-25",
        comments: [],
        image: null,
        imagePosition: "top",
        imageSize: "medium",
        imageShape: "natural"
      });
      savePosts();
    }

    const postList = document.getElementById('postList');
    const postContent = document.getElementById('postContent');
    const filterSortBar = document.getElementById('filterSortBar');
    const homeButton = document.getElementById('homeButton');
    const adminSection = document.getElementById('adminSection');
    const toggleAdminButton = document.getElementById('toggleAdminButton');
    const addPostButton = document.getElementById('addPostButton');
    const postImageInput = document.getElementById('postImage');
    const paragraphBoxes = document.getElementById('paragraphBoxes');
    const addParagraphBoxButton = document.getElementById('addParagraphBoxButton');
    let paragraphCount = 0;

    // Helper to create a new paragraph box with image controls
    function createParagraphBox() {
      paragraphCount++;
      const wrapper = document.createElement('div');
      wrapper.className = 'paragraphBoxWrapper';
      wrapper.style.marginBottom = '20px';
      wrapper.innerHTML = `
        <label>Text Box ${paragraphCount}:</label>
        <textarea class="paragraphBox" placeholder="Enter paragraph ${paragraphCount}"></textarea>
        <label>Image (optional):</label>
        <input type="file" class="paragraphImage" accept="image/*" />
        <label>Image Position:</label>
        <select class="paragraphImagePosition">
          <option value="top">Top (default)</option>
          <option value="left">Left of text</option>
          <option value="right">Right of text</option>
          <option value="none">Do not display</option>
        </select>
        <label>Image Size:</label>
        <select class="paragraphImageSize">
          <option value="small">Small</option>
          <option value="medium" selected>Medium</option>
          <option value="large">Large</option>
        </select>
        <label>Image Shape:</label>
        <select class="paragraphImageShape">
          <option value="natural">Natural</option>
          <option value="circle">Circle</option>
          <option value="circle-shadow">Circle with Shadow</option>
          <option value="rounded">Rounded Corners</option>
        </select>
        <div class="paragraphImagePreview"></div>
        <hr>
      `;
      // Preview image on file select
      wrapper.querySelector('.paragraphImage').addEventListener('change', function() {
        const preview = wrapper.querySelector('.paragraphImagePreview');
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.innerHTML = `<img src="${e.target.result}" style="max-width:100px;max-height:100px;margin-top:5px;border-radius:8px;" />`;
          };
          reader.readAsDataURL(this.files[0]);
        } else {
          preview.innerHTML = '';
        }
      });
      paragraphBoxes.appendChild(wrapper);
    }

    // Start with one text box
    paragraphBoxes.innerHTML = '';
    createParagraphBox();

    addParagraphBoxButton.onclick = createParagraphBox;

    filterSortBar.addEventListener('change', displayPosts);
    homeButton.addEventListener('click', () => {
      postContent.innerHTML = `<h2>About Me</h2><p>Hi, I'm Max Krupp, a Vermont native who's passionate about basketball. I plan to use this blog as an opportunity to share my knowledge of the sport and break down current events at both the professional and collegiate levels. I will discuss trade rumors, free agent signings, transfer portal announcements, player performance, and many other topics that I hope viewers find just as exciting to read as I do to write. Join me as we explore the stories, players, and teams
        that make the game so exciting.</p>`;
    });
    toggleAdminButton.addEventListener('click', () => {
      adminSection.style.display = adminSection.style.display === 'none' ? 'block' : 'none';
    });

    addPostButton.addEventListener('click', () => {
      const title = document.getElementById('postTitle').value;
      const date = document.getElementById('postDate').value;
      const imageInput = document.getElementById('postImage');
      const imagePosition = document.getElementById('imagePosition').value;
      const imageSize = document.getElementById('imageSize').value;
      const imageShape = document.getElementById('imageShape').value;

      // Gather all paragraph boxes and their image settings
      const wrappers = Array.from(document.getElementsByClassName('paragraphBoxWrapper'));
      const paragraphData = [];

      let pendingImages = 0;
      let done = () => {};

      wrappers.forEach((wrapper, i) => {
        const text = wrapper.querySelector('.paragraphBox').value.trim();
        const imgInput = wrapper.querySelector('.paragraphImage');
        const imgPos = wrapper.querySelector('.paragraphImagePosition').value;
        const imgSize = wrapper.querySelector('.paragraphImageSize').value;
        const imgShape = wrapper.querySelector('.paragraphImageShape').value;

        if (imgInput.files && imgInput.files[0]) {
          pendingImages++;
          const reader = new FileReader();
          reader.onload = function(e) {
            paragraphData[i] = { text, image: e.target.result, imagePosition: imgPos, imageSize: imgSize, imageShape: imgShape };
            pendingImages--;
            if (pendingImages === 0) done();
          };
          reader.readAsDataURL(imgInput.files[0]);
        } else {
          paragraphData[i] = { text, image: null, imagePosition: imgPos, imageSize: imgSize, imageShape: imgShape };
        }
      });

      done = function() {
        // Remove empty paragraphs
        const filteredParagraphs = paragraphData.filter(p => p.text.length > 0 || p.image);
        if (title && filteredParagraphs.length && date) {
          // Main image logic as before
          if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
              posts.push({
                title, date, comments: [],
                image: e.target.result,
                imagePosition, imageSize, imageShape,
                paragraphs: filteredParagraphs
              });
              savePosts();
              displayPosts();
              document.getElementById('postTitle').value = '';
              document.getElementById('postDate').value = '';
              imageInput.value = '';
              document.getElementById('imagePosition').value = 'top';
              document.getElementById('imageSize').value = 'medium';
              document.getElementById('imageShape').value = 'natural';
              paragraphBoxes.innerHTML = '';
              paragraphCount = 0;
              createParagraphBox();
            };
            reader.readAsDataURL(imageInput.files[0]);
          } else {
            posts.push({
              title, date, comments: [],
              image: null,
              imagePosition, imageSize, imageShape,
              paragraphs: filteredParagraphs
            });
            savePosts();
            displayPosts();
            document.getElementById('postTitle').value = '';
            document.getElementById('postDate').value = '';
            imageInput.value = '';
            document.getElementById('imagePosition').value = 'top';
            document.getElementById('imageSize').value = 'medium';
            document.getElementById('imageShape').value = 'natural';
            paragraphBoxes.innerHTML = '';
            paragraphCount = 0;
            createParagraphBox();
          }
        } else {
          alert('Please fill out all fields and at least one paragraph.');
        }
      };

      if (pendingImages === 0) done();
    });

    // --- Add edit/delete controls to each post in the sidebar ---
    function displayPosts() {
      const selectedOption = filterSortBar.value;
      let filteredPosts = posts.slice();
      if (selectedOption === "newest") filteredPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
      if (selectedOption === "oldest") filteredPosts.sort((a, b) => new Date(a.date) - new Date(b.date));
      postList.innerHTML = '';
      filteredPosts.forEach((post, index) => {
        const div = document.createElement('div');
        div.className = 'post-title';
        div.innerHTML = `
          <span style="cursor:pointer;">${post.title}</span>
          <button class="editPostBtn">Edit</button>
          <button class="deletePostBtn">Delete</button>
        `;
        div.querySelector('span').onclick = () => displayPostContent(index);
        div.querySelector('.editPostBtn').onclick = (e) => {
          e.stopPropagation();
          showEditPostForm(index);
        };
        div.querySelector('.deletePostBtn').onclick = (e) => {
          e.stopPropagation();
          if (confirm('Are you sure you want to delete this post?')) {
            posts.splice(index, 1);
            savePosts();
            displayPosts();
            postContent.innerHTML = '<h2>Select a post to view it here.</h2>';
          }
        };
        postList.appendChild(div);
      });
    }

    // --- IMAGE HTML HELPERS WITH CIRCLE SHADOW SUPPORT ---
    function getImageHtml(post) {
      if (!post.image || post.imagePosition === 'none') return '';
      let sizeCss = '';
      if (post.imageSize === 'small') sizeCss = 'max-width:100px;';
      else if (post.imageSize === 'large') sizeCss = 'max-width:350px;';
      else sizeCss = 'max-width:200px;';
      let shapeClass = '';
      let shapeCss = '';
      if (post.imageShape === 'circle-shadow') {
        shapeClass = 'circle-shadow';
      } else if (post.imageShape === 'circle') {
        shapeCss = 'border-radius:50%;object-fit:cover;';
      } else if (post.imageShape === 'rounded') {
        shapeCss = 'border-radius:18px;';
      }
      let floatCss = '';
      if (post.imagePosition === 'left') floatCss = 'float:left;margin:0 1em 1em 0;';
      else if (post.imagePosition === 'right') floatCss = 'float:right;margin:0 0 1em 1em;';
      else floatCss = 'display:block;margin:0 auto 24px auto;';
      return `<img src="${post.image}" class="${shapeClass}" style="${sizeCss}${shapeCss}${floatCss}" alt="Main Image" />`;
    }

    function getParagraphImageHtml(p) {
      if (!p.image || p.imagePosition === 'none') return '';
      let sizeCss = '';
      if (p.imageSize === 'small') sizeCss = 'max-width:100px;';
      else if (p.imageSize === 'large') sizeCss = 'max-width:350px;';
      else sizeCss = 'max-width:200px;';
      let shapeClass = '';
      let shapeCss = '';
      if (p.imageShape === 'circle-shadow') {
        shapeClass = 'circle-shadow';
      } else if (p.imageShape === 'circle') {
        shapeCss = 'border-radius:50%;object-fit:cover;';
      } else if (p.imageShape === 'rounded') {
        shapeCss = 'border-radius:18px;';
      }
      let floatCss = '';
      if (p.imagePosition === 'left') floatCss = 'float:left;margin:0 1em 1em 0;';
      else if (p.imagePosition === 'right') floatCss = 'float:right;margin:0 0 1em 1em;';
      else floatCss = 'display:block;margin:0 auto 24px auto;';
      return `<img src="${p.image}" class="${shapeClass}" style="${sizeCss}${shapeCss}${floatCss}" alt="Paragraph Image" />`;
    }

    // --- EDIT POST FORM ---
    function showEditPostForm(index) {
      const post = posts[index];
      let paragraphsHtml = '';
      if (post.paragraphs && post.paragraphs.length) {
        post.paragraphs.forEach((p, i) => {
          paragraphsHtml += `
            <div class="paragraphBoxWrapper" style="margin-bottom:20px;">
              <label>Text Box ${i + 1}:</label>
              <textarea class="editParagraphBox" data-i="${i}" style="width:100%;">${p.text || ''}</textarea>
              <label>Image (optional):</label>
              <input type="file" class="editParagraphImage" data-i="${i}" accept="image/*" />
              ${p.image ? `<img src="${p.image}" class="editParagraphImagePreview" data-i="${i}" style="max-width:100px;max-height:100px;margin-top:5px;border-radius:8px;" />` : `<div class="editParagraphImagePreview" data-i="${i}"></div>`}
              <label>Image Position:</label>
              <select class="editParagraphImagePosition" data-i="${i}">
                <option value="top" ${p.imagePosition === 'top' ? 'selected' : ''}>Top (default)</option>
                <option value="left" ${p.imagePosition === 'left' ? 'selected' : ''}>Left of text</option>
                <option value="right" ${p.imagePosition === 'right' ? 'selected' : ''}>Right of text</option>
                <option value="none" ${p.imagePosition === 'none' ? 'selected' : ''}>Do not display</option>
              </select>
              <label>Image Size:</label>
              <select class="editParagraphImageSize" data-i="${i}">
                <option value="small" ${p.imageSize === 'small' ? 'selected' : ''}>Small</option>
                <option value="medium" ${!p.imageSize || p.imageSize === 'medium' ? 'selected' : ''}>Medium</option>
                <option value="large" ${p.imageSize === 'large' ? 'selected' : ''}>Large</option>
              </select>
              <label>Image Shape:</label>
              <select class="editParagraphImageShape" data-i="${i}">
                <option value="natural" ${!p.imageShape || p.imageShape === 'natural' ? 'selected' : ''}>Natural</option>
                <option value="circle" ${p.imageShape === 'circle' ? 'selected' : ''}>Circle</option>
                <option value="circle-shadow" ${p.imageShape === 'circle-shadow' ? 'selected' : ''}>Circle with Shadow</option>
                <option value="rounded" ${p.imageShape === 'rounded' ? 'selected' : ''}>Rounded Corners</option>
              </select>
              <hr>
            </div>
          `;
        });
      }
      postContent.innerHTML = `
        <div class="story-pro">
          <h2>Edit Post</h2>
          <label>Title:</label>
          <input type="text" id="editTitle" value="${post.title}" style="width:100%;margin-bottom:10px;" />
          <label>Main Image (optional):</label>
          <input type="file" id="editImage" accept="image/*" style="margin-bottom:10px;" />
          ${post.image ? `<img src="${post.image}" id="editImagePreview" class="story-image" style="margin-bottom:10px;" alt="Current Image" />` : `<div id="editImagePreview"></div>`}
          <label>Image Position:</label>
          <select id="editImagePosition">
            <option value="top" ${post.imagePosition === 'top' ? 'selected' : ''}>Top (default)</option>
            <option value="left" ${post.imagePosition === 'left' ? 'selected' : ''}>Left of text</option>
            <option value="right" ${post.imagePosition === 'right' ? 'selected' : ''}>Right of text</option>
            <option value="none" ${post.imagePosition === 'none' ? 'selected' : ''}>Do not display</option>
          </select>
          <label>Image Size:</label>
          <select id="editImageSize">
            <option value="small" ${post.imageSize === 'small' ? 'selected' : ''}>Small</option>
            <option value="medium" ${!post.imageSize || post.imageSize === 'medium' ? 'selected' : ''}>Medium</option>
            <option value="large" ${post.imageSize === 'large' ? 'selected' : ''}>Large</option>
          </select>
          <label>Image Shape:</label>
          <select id="editImageShape">
            <option value="natural" ${!post.imageShape || post.imageShape === 'natural' ? 'selected' : ''}>Natural</option>
            <option value="circle" ${post.imageShape === 'circle' ? 'selected' : ''}>Circle</option>
            <option value="circle-shadow" ${post.imageShape === 'circle-shadow' ? 'selected' : ''}>Circle with Shadow</option>
            <option value="rounded" ${post.imageShape === 'rounded' ? 'selected' : ''}>Rounded Corners</option>
          </select>
          <label>Date:</label>
          <input type="date" id="editDate" value="${post.date}" style="width:100%;margin-bottom:10px;" />
          <h3>Paragraphs</h3>
          <div id="editParagraphs">${paragraphsHtml}</div>
          <button id="saveEditButton">Save</button>
          <button id="cancelEditButton" style="margin-left:10px;">Cancel</button>
        </div>
      `;

      // Main image preview
      document.getElementById('editImage').addEventListener('change', function() {
        const preview = document.getElementById('editImagePreview');
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            if (preview.tagName === "IMG") {
              preview.src = e.target.result;
            } else {
              preview.innerHTML = `<img src="${e.target.result}" class="story-image" style="margin-bottom:10px;" alt="Current Image" />`;
            }
          };
          reader.readAsDataURL(this.files[0]);
        }
      });

      // Paragraph image preview
      document.querySelectorAll('.editParagraphImage').forEach(input => {
        input.addEventListener('change', function() {
          const i = this.getAttribute('data-i');
          const preview = document.querySelector(`.editParagraphImagePreview[data-i="${i}"]`);
          if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
              if (preview && preview.tagName === "IMG") {
                preview.src = e.target.result;
              } else if (preview) {
                preview.innerHTML = `<img src="${e.target.result}" class="editParagraphImagePreview" data-i="${i}" style="max-width:100px;max-height:100px;margin-top:5px;border-radius:8px;" />`;
              }
            };
            reader.readAsDataURL(this.files[0]);
          }
        });
      });

      document.getElementById('saveEditButton').onclick = function() {
        post.title = document.getElementById('editTitle').value;
        post.date = document.getElementById('editDate').value;
        post.imagePosition = document.getElementById('editImagePosition').value;
        post.imageSize = document.getElementById('editImageSize').value;
        post.imageShape = document.getElementById('editImageShape').value;

        // Update paragraphs
        let pending = 0;
        let done = function() {
          savePosts();
          displayPosts();
          displayPostContent(index);
        };

        if (post.paragraphs && post.paragraphs.length) {
          document.querySelectorAll('.paragraphBoxWrapper').forEach((wrapper, i) => {
            post.paragraphs[i].text = wrapper.querySelector('.editParagraphBox').value;
            post.paragraphs[i].imagePosition = wrapper.querySelector('.editParagraphImagePosition').value;
            post.paragraphs[i].imageSize = wrapper.querySelector('.editParagraphImageSize').value;
            post.paragraphs[i].imageShape = wrapper.querySelector('.editParagraphImageShape').value;
            const imgInput = wrapper.querySelector('.editParagraphImage');
            if (imgInput.files && imgInput.files[0]) {
              pending++;
              const reader = new FileReader();
              reader.onload = function(e) {
                post.paragraphs[i].image = e.target.result;
                pending--;
                if (pending === 0) done();
              };
              reader.readAsDataURL(imgInput.files[0]);
            }
          });
        }

        // Main image update
        const imageInput = document.getElementById('editImage');
        if (imageInput.files && imageInput.files[0]) {
          pending++;
          const reader = new FileReader();
          reader.onload = function(e) {
            post.image = e.target.result;
            pending--;
            if (pending === 0) done();
          };
          reader.readAsDataURL(imageInput.files[0]);
        }

        if (pending === 0) done();
      };

      document.getElementById('cancelEditButton').onclick = () => displayPostContent(index);
    }

    function displayPostContent(index) {
      const post = posts[index];
      let imageHtml = getImageHtml(post);
      let contentHtml = '';
      if (post.paragraphs && post.paragraphs.length) {
        contentHtml = post.paragraphs.map(p => {
          let img = getParagraphImageHtml(p);
          if (p.image && p.imagePosition === 'left') {
            return `<div>${img}<div style="overflow:hidden;"><p>${p.text}</p></div></div>`;
          } else if (p.image && p.imagePosition === 'right') {
            return `<div>${img}<div style="overflow:hidden;"><p>${p.text}</p></div></div>`;
          } else if (p.image && p.imagePosition === 'top') {
            return `${img}<div><p>${p.text}</p></div>`;
          } else {
            return `<div><p>${p.text}</p></div>`;
          }
        }).join('');
      } else {
        if (post.image && post.imagePosition === 'left') {
          contentHtml = `<div>${imageHtml}<div style="overflow:hidden;">${post.content}</div></div>`;
        } else if (post.image && post.imagePosition === 'right') {
          contentHtml = `<div>${imageHtml}<div style="overflow:hidden;">${post.content}</div></div>`;
        } else if (post.image && post.imagePosition === 'top') {
          contentHtml = `${imageHtml}<div>${post.content}</div>`;
        } else {
          contentHtml = `<div>${post.content}</div>`;
        }
      }
      postContent.innerHTML = `
        <div class="story-pro">
          <h2>${post.title}</h2>
          <div class="meta">
            <span class="date">${post.date}</span>
            <span class="author">By Max Krupp</span>
          </div>
          <div class="content">${contentHtml}</div>
          <hr class="divider" />
          <div class="comment-section">
            <h3>Comments</h3>
            <div id="commentsSection"></div>
            <textarea id="commentInput" placeholder="Write a comment..." style="width: 100%; margin-bottom: 10px;"></textarea>
            <button id="addCommentButton">Add Comment</button>
          </div>
        </div>
      `;

      const commentsSection = document.getElementById('commentsSection');
      post.comments.forEach((comment, commentIndex) => {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment';
        commentDiv.innerHTML = `
          <p>${comment.text}</p>
          <button class="replyButton" data-index="${commentIndex}">Reply (Admin Only)</button>
          <div class="replies">
            ${(comment.replies || []).map(reply => `<p>${reply}</p>`).join('')}
          </div>
          <div id="replyInputContainer-${commentIndex}" style="display:none;margin-top:5px;">
            <input type="text" id="replyInput-${commentIndex}" placeholder="Your reply as Max Krupp..." style="width:80%;" />
            <button onclick="submitReply(${index},${commentIndex})">Send</button>
          </div>
        `;
        commentsSection.appendChild(commentDiv);
      });

      document.querySelectorAll('.replyButton').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = this.getAttribute('data-index');
          document.getElementById(`replyInputContainer-${idx}`).style.display = 'block';
        });
      });

      document.getElementById('addCommentButton').onclick = () => {
        const commentText = document.getElementById('commentInput').value;
        if (commentText.trim()) {
          post.comments.push({ text: commentText, replies: [] });
          savePosts();
          displayPostContent(index);
        }
      };
    }

    window.submitReply = function(postIndex, commentIndex) {
      const replyInput = document.getElementById(`replyInput-${commentIndex}`);
      const replyText = replyInput.value.trim();
      if (replyText) {
        posts[postIndex].comments[commentIndex].replies = posts[postIndex].comments[commentIndex].replies || [];
        posts[postIndex].comments[commentIndex].replies.push(`Max Krupp: ${replyText}`);
        savePosts();
        displayPostContent(postIndex);
      }
    };

    // Initial display
    displayPosts();
  </script>
</body>
</html>